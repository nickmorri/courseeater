<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>CourseEater - Account Settings</title>
    <link rel="icon" type="image/png" href="favicon.png">
    
    <!-- Services -->
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="https://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
	
	<!-- Stylesheets -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    
    <script>
		
		Parse.initialize("ZJuxK6cPbOs5u3hy78QuIIojsBLnrDgpPeY9EQNU", "Rncx0sNYiCARajhzNE2m86l4HXdmYxo3yZ2AGJNy");	
	    if (Parse.User.current() == null) {window.location.replace("index.html");}
	    
	    $(document).ready(function() {
			$("#userNameDisplay").text(Parse.User.current().get("username"));
	    	$("#new_email").attr("placeholder", Parse.User.current().get("email"));

	    	$("#updateEmail").submit(function() {
	    		event.preventDefault();
				var newEmail = $("#new_email").val();
				Parse.User.current().set("email", newEmail);
				Parse.User.current().save();
				$(".alert-account-email span").text("Email changed to " + newEmail);
				$(".alert-account-email").show();
				$("#new_email").attr("placeholder", newEmail);
				$("#new_email").val("");
			});
			
			$("#updatePassword").submit(function() {
				if ($("#inputNewPassword").val() != $("#inputVerifyPassword").val()) {
					$(".alert-account-password span").text("Passwords do not match.");
					$(".alert-account-password").show();
					$("#inputNewPassword").val("");
					$("#inputVerifyPassword").val("");
				}
				event.preventDefault();
				Parse.User.logIn(Parse.User.current().get("username"), $("#inputCurrentPassword").val(), {
					success: function(user) {
						Parse.User.current().set("password", $("#inputNewPassword").val());
						Parse.User.current().save();
						$(".alert-account-password span").text("Password updated");
						$(".alert-account-password").show();
						$("#inputNewPassword").val("");
						$("#inputVerifyPassword").val("");
						$("#inputCurrentPassword").val("");
					},
					error: function(user, error) {
						window.location.replace("index.html");
					}	
				});
			});
			
			$("#deleteAccount").submit(function() {
				event.preventDefault();
				Parse.User.logIn(Parse.User.current().get("username"), $("#password_delete_account").val(), {
					success: function(user) {
						Parse.User.current().destroy({
							success: function(user) {
								Parse.User.logOut();
								sessionStorage.clear();
								window.location.replace("index.html");
							},
							error: function(user, error) {
								console.log(error);
							}
						});
					},
					error: function(user, error) {
						console.log(error);
					}	
				});
			});
			
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			
			ga('create', 'UA-9939990-3', 'courseeater.com');
			ga('send', 'pageview');
			
		});
    </script>
</head>
<body>

	<header class="navbar navbar-static-top" role="banner">
    	<nav class="navbar navbar-default navbar-static-top" role="navigation">
        	<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="index.html">CourseEater</a>
				</div>
				<div class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li><a href="track.html"><span class="glyphicon glyphicon-book"></span> Track</a></li>
					</ul>
					<ul class="nav navbar-nav navbar-right">
						<li class="dropdown active">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-user"></span> <span id="userNameDisplay"></span></a>
							<ul class="dropdown-menu">
								<li><a href="#"><span class="glyphicon glyphicon-cog"></span> Account Settings</a></li>
								<li><a id="logout" href="#"><span class="glyphicon glyphicon-log-out"></span> Sign out</a></li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</nav>
	</header>
  
	<div class="container form-user-management">
  		<div class="jumbotron">
  			<h3>Account<br><small>Change your basic account settings</small></h3>
  			
  			<div class="panel panel-default">
  				<div class="panel-heading">
	  				<h3 class="panel-title">Change email preferences</h3>
	  			</div>  			
	  			<div class="panel-body">
	  			
  					<form id="updateEmail" class="form-horizontal" role="form">
	  					<div class="form-group">
		  					<label for="new_email" class="col-sm-2 control-label">Email</label>
		  					<div class="col-sm-10">
			  					<input type="email" class="form-control update-info" id="new_email" placeholder="Email" />
			  				</div>
	  					</div>
	  					<input type="submit" class="btn btn-lg btn-primary btn-block button-spaced" value="Update Email" />
	  				</form>
	  				
	  				<div class='alert alert-success alert-dismissable alert-account-info alert-account-email' style="display:none">
						<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>
						<span></span>
					</div>
					
	  			</div>
	  		</div>
  		
	  		<div class="panel panel-default">
  				<div class="panel-heading">
	  				<h3 class="panel-title">Change password preferences</h3>
	  			</div>
	  			<div class="panel-body">
  					<form id="updatePassword" class="form-horizontal" role="form">
  						<div class="form-group">
		  					<label for="inputCurrentPassword" class="col-sm-2 control-label">Current password</label>
		  					<div class="col-sm-10">
			  					<input type="password" class="form-control update-info" id="inputCurrentPassword" placeholder="Current password" />
		  					</div>
		  					<label for="inputNewPassword" class="col-sm-2 control-label">New password</label>
		  					<div class="col-sm-10">
			  					<input type="password" class="form-control update-info" id="inputNewPassword" placeholder="New password" />
		  					</div>
		  					<label for="inputVerifyPassword" class="col-sm-2 control-label">Verify password</label>
		  					<div class="col-sm-10">
			  					<input type="password" class="form-control update-info" id="inputVerifyPassword" placeholder="Verify password" />
		  					</div>
  						</div>
	  					<input type="submit" class="btn btn-lg btn-primary btn-block button-spaced" value="Update Password" />
	  				</form>
	  				<div class='alert alert-success alert-dismissable alert-account-info alert-account-password' style="display:none">
						<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>
						<span></span>
					</div>
	  			</div>
	  		</div>
  		
	  		<div class="panel panel-default">
  				<div class="panel-heading">
		  			<h3 class="panel-title">Delete account permanently</h3>
		  		</div>
		  		<div class="panel-body"> 
	  				<form id="deleteAccount" class="form-horizontal" role="form">
	  					<div class="form-group">
		  					<label for="password_delete_account" class="col-sm-2 control-label">Current password</label>
		  					<div class="col-sm-10">
			  					<input type="password" class="form-control update-info" id="password_delete_account" placeholder="Current password" />
		  					</div>
	  					</div>
	  					<input type="submit" class="btn btn-lg btn-primary btn-block button-spaced" value="Delete account" />
	  				</form>
	  			</div>
	  		</div>
  		</div>
	</div>
  
	<script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
</body>
</html>
